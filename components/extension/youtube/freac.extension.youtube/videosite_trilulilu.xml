<VideoSite>
  <name>Trilulilu.ro</name>
  <version>1.0</version>
  <decoders>
    <decoder>avconv-flv_audio-dec</decoder>
    <decoder>avconv-m4v_audio-dec</decoder>
  </decoders>

  <script type="text/javascript">
    <![CDATA[
      function canHandleURL(URL) {
	if (URL.toLowerCase().match(/http:\/\/www.trilulilu.ro\/.+/)) return true;
	else							      return false;
      }

      function getDecoderID(html) {
	var server  = "fs" + (html.match(/"server":"([0-9]+)"/), RegExp.$1) + ".trilulilu.ro";
	var user    = (html.match(/"userid":"(.*?)"/), RegExp.$1);
	var hash    = (html.match(/"hash":"([0-9a-f]+)"/), RegExp.$1);
	var formats = downloadURL("http://" + server + "/" + hash + "/video-formats2");
	var format  = (formats.match(/<format>(.*?)<\/format>/), RegExp.$1);

	if	(format.match(/mp4.*/)) return "avconv-m4v_audio-dec";
 	else if (format.match(/flv.*/)) return "avconv-flv_audio-dec";
     }

      function getVideoURL(html) {
	var server  = "fs" + (html.match(/"server":"([0-9]+)"/), RegExp.$1) + ".trilulilu.ro";
	var user    = (html.match(/"userid":"(.*?)"/), RegExp.$1);
	var hash    = (html.match(/"hash":"([0-9a-f]+)"/), RegExp.$1);
	var formats = downloadURL("http://" + server + "/" + hash + "/video-formats2");
	var format  = (formats.match(/<format>(.*?)<\/format>/), RegExp.$1);

	return "http://" + server + "/stream.php?type=video&source=site&hash=" + hash + "&username=" + user + "&key=ministhebest&format=" + format + "&sig=&exp=";
      }

      function queryMetadata(html) {
	var metadata = new Metadata();

	metadata.title	     = (html.match(/<meta property="og:title"[\s]+content="(.*?)".*?\/>/) ? RegExp.$1 : null);
	metadata.description = (html.match(/<meta property="og:description"[\s]+content="(.*?)".*?\/>/) ? RegExp.$1 : null);

	metadata.thumbnail   = (html.match(/<meta property="og:image"[\s]+content="(.*?)".*?\/>/) ? RegExp.$1 : null);

	metadata.uploader    = (html.match(/"userid":"(.*?)"/), RegExp.$1);

	return metadata;
      }
    ]]>
  </script>
</VideoSite>